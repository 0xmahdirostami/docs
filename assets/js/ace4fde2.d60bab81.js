"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5604],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>k});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),d=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(a),m=o,k=p["".concat(s,".").concat(m)]||p[m]||u[m]||r;return a?n.createElement(k,i(i({ref:t},c),{},{components:a})):n.createElement(k,i({ref:t},c))}));function k(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var d=2;d<r;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},8065:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var n=a(3117),o=(a(7294),a(3905));const r={},i="Validator Ejector",l={unversionedId:"guides/validator-ejector-guide",id:"guides/validator-ejector-guide",title:"Validator Ejector",description:"Introduction",source:"@site/docs/guides/validator-ejector-guide.md",sourceDirName:"guides",slug:"/guides/validator-ejector-guide",permalink:"/guides/validator-ejector-guide",draft:!1,editUrl:"https://github.com/lidofinance/docs/blob/main/docs/guides/validator-ejector-guide.md",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Tooling Overview",permalink:"/guides/tooling"},next:{title:"Keys API",permalink:"/guides/kapi-guide"}},s={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Hardware",id:"hardware",level:3},{value:"Nodes",id:"nodes",level:3},{value:"Software",id:"software",level:3},{value:"Using Docker:",id:"using-docker",level:4},{value:"Running directly or using for message encryption:",id:"running-directly-or-using-for-message-encryption",level:4},{value:"Exit Messages",id:"exit-messages",level:2},{value:"Generic Format",id:"generic-format",level:3},{value:"ethdo Output Format",id:"ethdo-output-format",level:3},{value:"Encrypted Format",id:"encrypted-format",level:3},{value:"Encrypting Messages",id:"encrypting-messages",level:2},{value:"Encryption using Ejector - Source Code",id:"encryption-using-ejector---source-code",level:3},{value:"Encryption using Ejector - Docker",id:"encryption-using-ejector---docker",level:3},{value:"Env Variables",id:"env-variables",level:2},{value:"EXECUTION_NODE",id:"execution_node",level:3},{value:"CONSENSUS_NODE",id:"consensus_node",level:3},{value:"LOCATOR_ADDRESS",id:"locator_address",level:3},{value:"STAKING_MODULE_ID",id:"staking_module_id",level:3},{value:"OPERATOR_ID",id:"operator_id",level:3},{value:"MESSAGES_LOCATION",id:"messages_location",level:3},{value:"VALIDATOR_EXIT_WEBHOOK",id:"validator_exit_webhook",level:3},{value:"ORACLE_ADDRESSES_ALLOWLIST",id:"oracle_addresses_allowlist",level:3},{value:"MESSAGES_PASSWORD",id:"messages_password",level:3},{value:"MESSAGES_PASSWORD_FILE",id:"messages_password_file",level:3},{value:"BLOCKS_PRELOAD",id:"blocks_preload",level:3},{value:"HTTP_PORT",id:"http_port",level:3},{value:"RUN_METRICS",id:"run_metrics",level:3},{value:"RUN_HEALTH_CHECK",id:"run_health_check",level:3},{value:"LOGGER_LEVEL",id:"logger_level",level:3},{value:"LOGGER_FORMAT",id:"logger_format",level:3},{value:"LOGGER_SECRETS",id:"logger_secrets",level:3},{value:"DRY_RUN",id:"dry_run",level:3},{value:"Advanced Parameters",id:"advanced-parameters",level:3},{value:"Running",id:"running",level:2},{value:"Source Code",id:"source-code",level:3},{value:"Docker with docker-compose",id:"docker-with-docker-compose",level:3},{value:"Check Ejector is working",id:"check-ejector-is-working",level:2},{value:"What if something is wrong?",id:"what-if-something-is-wrong",level:2},{value:"Additional Resources",id:"additional-resources",level:2}],c={toc:d},p="wrapper";function u(e){let{components:t,...a}=e;return(0,o.kt)(p,(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"validator-ejector"},"Validator Ejector"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Ejector is a daemon service which monitors ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lidofinance/lido-dao/blob/feature/shapella-upgrade/contracts/0.8.9/oracle/ValidatorsExitBusOracle.sol"},"ValidatorsExitBusOracle")," events and sends out stored exit messages when necessary. It allows Node Operators to generate and sign exit messages ahead of time, which will be sent out by the Ejector when the Protocol requests an exit to be made."),(0,o.kt)("p",null,"On start, it loads exit messages from a specified folder in form of individual ",(0,o.kt)("inlineCode",{parentName:"p"},".json")," files and validates their format, structure and signature. Then, it loads events from a configurable amount of latest finalized blocks, checks if exits should be made and after that periodically fetches fresh events."),(0,o.kt)("h2",{id:"requirements"},"Requirements"),(0,o.kt)("h3",{id:"hardware"},"Hardware"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"2-core CPU"),(0,o.kt)("li",{parentName:"ul"},"1GB RAM")),(0,o.kt)("h3",{id:"nodes"},"Nodes"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Execution Node - ",(0,o.kt)("a",{parentName:"li",href:"https://ethereum.org/en/developers/docs/nodes-and-clients/#node-types"},"Full node required")),(0,o.kt)("li",{parentName:"ul"},"Consensus Node")),(0,o.kt)("h3",{id:"software"},"Software"),(0,o.kt)("h4",{id:"using-docker"},"Using Docker:"),(0,o.kt)("p",null,"Docker + docker-compose."),(0,o.kt)("h4",{id:"running-directly-or-using-for-message-encryption"},"Running directly or using for message encryption:"),(0,o.kt)("p",null,"Node.js 16."),(0,o.kt)("h2",{id:"exit-messages"},"Exit Messages"),(0,o.kt)("p",null,"Ejector loads and validates exit messages on start. This means that any changes to the messages folder (eg new exit messages) require a restart of the app to be picked up."),(0,o.kt)("p",null,"Ejector accepts messages in three formats:"),(0,o.kt)("h3",{id:"generic-format"},"Generic Format"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "message": { "epoch": "123", "validator_index": "123" },\n  "signature": "0x123"\n}\n')),(0,o.kt)("h3",{id:"ethdo-output-format"},"ethdo Output Format"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "exit": {\n    "message": { "epoch": "123", "validator_index": "123" },\n    "signature": "0x123"\n  },\n  "fork_version": "0x123"\n}\n')),(0,o.kt)("h3",{id:"encrypted-format"},"Encrypted Format"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": 4,\n  "uuid": "123abc-123abc-123abc",\n  "path": "",\n  "pubkey": "",\n  "crypto": {\n    "kdf": {\n      "function": "pbkdf2",\n      "params": {\n        "dklen": 123,\n        "c": 123,\n        "prf": "hmac-sha256",\n        "salt": "123abc"\n      },\n      "message": ""\n    },\n    "checksum": {\n      "function": "sha256",\n      "params": {},\n      "message": "123abc"\n    },\n    "cipher": {\n      "function": "aes-128-ctr",\n      "params": { "iv": "123abc" },\n      "message": "123abc"\n    }\n  }\n}\n')),(0,o.kt)("h2",{id:"encrypting-messages"},"Encrypting Messages"),(0,o.kt)("p",null,"It is highly advised that after exit message are generated and signed, they should be encrypted for storage safety. Ejector will decrypt files on start by looking up the password in ",(0,o.kt)("inlineCode",{parentName:"p"},"MESSAGES_PASSWORD")," environment variable."),(0,o.kt)("p",null,"Exit messages are encrypted and decrypted by Ejector following the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2335.md"},"EIP-2335")," spec."),(0,o.kt)("p",null,"Ejector is bundled with a small, easy to use encryption script."),(0,o.kt)("h3",{id:"encryption-using-ejector---source-code"},"Encryption using Ejector - Source Code"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Clone repository:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/lidofinance/validator-ejector.git\ncd validator-ejector\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Create ",(0,o.kt)("inlineCode",{parentName:"li"},".env")," file with encryption password or pass before the command:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"MESSAGES_PASSWORD=password\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"Copy JSON exit message files to ",(0,o.kt)("inlineCode",{parentName:"li"},"encryptor/input")),(0,o.kt)("li",{parentName:"ol"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"yarn & yarn encrypt")),(0,o.kt)("li",{parentName:"ol"},"Encrypted exit message files will be saved to ",(0,o.kt)("inlineCode",{parentName:"li"},"encryptor/output"))),(0,o.kt)("h3",{id:"encryption-using-ejector---docker"},"Encryption using Ejector - Docker"),(0,o.kt)("p",null,"Ejector is bundled with encryptor script inside, so you can run it using the same Docker image:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"docker run \\\n        -e MESSAGES_PASSWORD=secret \\\n        -v /full/path/to/input:/app/encryptor/input/ \\\n        -v /full/path/to/output:/app/encryptor/output/ \\\n        lidofinance/validator-ejector@sha256:<hash> \\\n        node /app/dist/encryptor/encrypt.js\n")),(0,o.kt)("p",null,"You can find a recommended version's hash ",(0,o.kt)("a",{parentName:"p",href:"/guides/tooling"},"here"),"."),(0,o.kt)("p",null,"For platforms with a different architecture but with emulation/transpilation support eg macOS on M processors, additionally specify:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"--platform linux/amd64\n")),(0,o.kt)("h2",{id:"env-variables"},"Env Variables"),(0,o.kt)("h3",{id:"execution_node"},"EXECUTION_NODE"),(0,o.kt)("p",null,"Address of the Execution Node."),(0,o.kt)("h3",{id:"consensus_node"},"CONSENSUS_NODE"),(0,o.kt)("p",null,"Address of the Consensus Node."),(0,o.kt)("h3",{id:"locator_address"},"LOCATOR_ADDRESS"),(0,o.kt)("p",null,"Address of the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lidofinance/lido-dao/blob/feature/shapella-upgrade/contracts/0.8.9/LidoLocator.sol"},"LidoLocator")," contract: ",(0,o.kt)("a",{parentName:"p",href:"https://docs.lido.fi/deployed-contracts/goerli"},"Goerli")," / ",(0,o.kt)("a",{parentName:"p",href:"https://docs.lido.fi/deployed-contracts/"},"Mainnet")),(0,o.kt)("h3",{id:"staking_module_id"},"STAKING_MODULE_ID"),(0,o.kt)("p",null,"ID of the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lidofinance/lido-dao/blob/feature/shapella-upgrade/contracts/0.8.9/StakingRouter.sol"},"StakingRouter")," contract module."),(0,o.kt)("p",null,"Currently, it has only one module (",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lidofinance/lido-dao/blob/feature/shapella-upgrade/contracts/0.4.24/nos/NodeOperatorsRegistry.sol"},"NodeOperatorsRegistry"),"), it's id is ",(0,o.kt)("inlineCode",{parentName:"p"},"1"),"."),(0,o.kt)("h3",{id:"operator_id"},"OPERATOR_ID"),(0,o.kt)("p",null,"You can find it on the Operators Dashboard (",(0,o.kt)("inlineCode",{parentName:"p"},"#123")," on the operator card): ",(0,o.kt)("a",{parentName:"p",href:"https://operators.testnet.fi"},"Goerli")," / ",(0,o.kt)("a",{parentName:"p",href:"https://operators.lido.fi"},"Mainnet")),(0,o.kt)("h3",{id:"messages_location"},"MESSAGES_LOCATION"),(0,o.kt)("p",null,"Location from which to load ",(0,o.kt)("inlineCode",{parentName:"p"},".json")," exit messages from."),(0,o.kt)("p",null,"When set, messages mode will be activated. Not needed if you are using the Ejector in webhook mode."),(0,o.kt)("p",null,"For example, ",(0,o.kt)("inlineCode",{parentName:"p"},"/messages")," in Docker or simply ",(0,o.kt)("inlineCode",{parentName:"p"},"messages")," if running directly for local files."),(0,o.kt)("p",null,"External storage bucket url is also supported for AWS S3 and Google Cloud Storage:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"s3://")," for S3"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"gs://")," for GCS")),(0,o.kt)("p",null,"Authentication setup: ",(0,o.kt)("a",{parentName:"p",href:"https://cloud.google.com/docs/authentication/application-default-credentials#attached-sa"},"GCS"),", ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/setting-credentials-node.html"},"S3"),"."),(0,o.kt)("h3",{id:"validator_exit_webhook"},"VALIDATOR_EXIT_WEBHOOK"),(0,o.kt)("p",null,"Endpoint to fetch when an exit has to be made. Allows to implement JIT approach by offloading exiting logic to an external service and using the Ejector as a secure exit events reader."),(0,o.kt)("p",null,"When set, webhook mode will be activated. Not needed if you are using the Ejector in messages mode."),(0,o.kt)("p",null,"On the endpoint, JSON will be POSTed with the following structure:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "validatorIndex": "123",\n  "validatorPubkey": "0x123"\n}\n')),(0,o.kt)("p",null,"200 response will be counted as a successful exit, non-200 as a fail."),(0,o.kt)("h3",{id:"oracle_addresses_allowlist"},"ORACLE_ADDRESSES_ALLOWLIST"),(0,o.kt)("p",null,"JSON array of Lido Oracle addresses, from which only report transactions will be accepted."),(0,o.kt)("p",null,"You can get a list from the Aragon app: ",(0,o.kt)("a",{parentName:"p",href:"https://testnet.testnet.fi/#/lido-testnet-prater/0x24d8451bc07e7af4ba94f69acdd9ad3c6579d9fb/"},"Goerli")," / ",(0,o.kt)("a",{parentName:"p",href:"https://mainnet.lido.fi/#/lido-dao/0xae7ab96520de3a18e5e111b5eaab095312d7fe84/"},"Mainnet")),(0,o.kt)("p",null,"Format:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'["0x123", "0x123"]\n')),(0,o.kt)("h3",{id:"messages_password"},"MESSAGES_PASSWORD"),(0,o.kt)("p",null,"Password to decrypt encrypted exit messages with on app start."),(0,o.kt)("h3",{id:"messages_password_file"},"MESSAGES_PASSWORD_FILE"),(0,o.kt)("p",null,"Alternative to ",(0,o.kt)("inlineCode",{parentName:"p"},"MESSAGES_PASSWORD"),". Path to a file with password inside to decrypt exit messages with. If used, MESSAGES_PASSWORD (not MESSAGES_PASSWORD_FILE) needs to be added to LOGGER_SECRETS in order to be sanitized"),(0,o.kt)("h3",{id:"blocks_preload"},"BLOCKS_PRELOAD"),(0,o.kt)("p",null,"Amount of blocks to load events from on start."),(0,o.kt)("p",null,"Suggested to include in your env variables, but to be left at default 50000 value (~7 days of blocks)."),(0,o.kt)("p",null,"In case your Ejector will be down due to an emergency, this value can be tweaked to let the Ejector load a higher amount of blocks on start."),(0,o.kt)("h3",{id:"http_port"},"HTTP_PORT"),(0,o.kt)("p",null,"Port for serving metrics and a health check endpoint. Default is 8989."),(0,o.kt)("h3",{id:"run_metrics"},"RUN_METRICS"),(0,o.kt)("p",null,"Enable with ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," to serve Prometheus metrics: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lidofinance/validator-ejector#metrics"},"full list"),"."),(0,o.kt)("p",null,"Will be served on ",(0,o.kt)("inlineCode",{parentName:"p"},"HOST:$HTTP_PORT/metrics"),"."),(0,o.kt)("p",null,"Highly advised for monitoring and alerting."),(0,o.kt)("h3",{id:"run_health_check"},"RUN_HEALTH_CHECK"),(0,o.kt)("p",null,"Enabled by default, disabled with ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),". Highly recommended to monitor this endpoint."),(0,o.kt)("p",null,"Will be served on ",(0,o.kt)("inlineCode",{parentName:"p"},"HOST:$HTTP_PORT/health"),"."),(0,o.kt)("h3",{id:"logger_level"},"LOGGER_LEVEL"),(0,o.kt)("p",null,"Recommended to set to ",(0,o.kt)("inlineCode",{parentName:"p"},"info")," (default), can be changed to ",(0,o.kt)("inlineCode",{parentName:"p"},"debug")," in case of issues for easier debugging."),(0,o.kt)("h3",{id:"logger_format"},"LOGGER_FORMAT"),(0,o.kt)("p",null,"Format of logs, ",(0,o.kt)("inlineCode",{parentName:"p"},"simple")," by default, but can be set to ",(0,o.kt)("inlineCode",{parentName:"p"},"json")," to be easily parseable by ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/grafana/loki"},"Loki"),", for example."),(0,o.kt)("h3",{id:"logger_secrets"},"LOGGER_SECRETS"),(0,o.kt)("p",null,"Env var names or exact values which should be replaced in logs, in JSON array of strings format."),(0,o.kt)("p",null,"Advised to include your MESSAGES_PASSWORD, EXECUTION_NODE, and MESSAGES_PASSWORD:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'["MESSAGES_PASSWORD", "EXECUTION_NODE", "CONSENSUS_NODE"]\n')),(0,o.kt)("p",null,"Notice: make sure quotes are copied correctly if copying this sample."),(0,o.kt)("h3",{id:"dry_run"},"DRY_RUN"),(0,o.kt)("p",null,"Allows to test the app with ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," without actually sending out exit messages."),(0,o.kt)("p",null,"Use with caution!"),(0,o.kt)("p",null,"Make sure to set to ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," or completely leave it out in production."),(0,o.kt)("h3",{id:"advanced-parameters"},"Advanced Parameters"),(0,o.kt)("p",null,"Please don't use unless suggested by a Lido contributor."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"BLOCKS_LOOP - 900 (3 hours of blocks) - Amount of blocks Ejector looks behind on wake in polling jobs."),(0,o.kt)("li",{parentName:"ul"},"JOB_INTERVAL - 384000 (1 epoch) - Time for which Ejector sleeps between jobs."),(0,o.kt)("li",{parentName:"ul"},"DISABLE_SECURITY_DONT_USE_IN_PRODUCTION - false - Set to ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," to skip security checks, for example if Exit Bus Consensus contract was changed after the Ejector was unable to exit validators eg was switched off.")),(0,o.kt)("h2",{id:"running"},"Running"),(0,o.kt)("h3",{id:"source-code"},"Source Code"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Clone repository:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/lidofinance/validator-ejector.git\ncd validator-ejector\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Create exit messages folder, for example locally ",(0,o.kt)("inlineCode",{parentName:"li"},"mkdir messages")),(0,o.kt)("li",{parentName:"ol"},"Put exit message files in the messages folder."),(0,o.kt)("li",{parentName:"ol"},"Copy env sample file ",(0,o.kt)("inlineCode",{parentName:"li"},"cp sample.env .env")),(0,o.kt)("li",{parentName:"ol"},"Fill environment variables in ",(0,o.kt)("inlineCode",{parentName:"li"},".env")," file."),(0,o.kt)("li",{parentName:"ol"},"Run")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn\nyarn build\nyarn start\n")),(0,o.kt)("h3",{id:"docker-with-docker-compose"},"Docker with docker-compose"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create root folder for Ejector, cd into that folder."),(0,o.kt)("li",{parentName:"ol"},"Create exit messages folder ",(0,o.kt)("inlineCode",{parentName:"li"},"mkdir messages")),(0,o.kt)("li",{parentName:"ol"},"Put exit message files in messages folder."),(0,o.kt)("li",{parentName:"ol"},"Copy env file ",(0,o.kt)("inlineCode",{parentName:"li"},"cp sample.env .env")),(0,o.kt)("li",{parentName:"ol"},"Fill environment variables in .env file."),(0,o.kt)("li",{parentName:"ol"},"Create ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose.yml")," file using the following template:")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/lidofinance/validator-ejector/blob/develop/docker-compose.yml"},"https://github.com/lidofinance/validator-ejector/blob/develop/docker-compose.yml")),(0,o.kt)("ol",{start:6},(0,o.kt)("li",{parentName:"ol"},"Run ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose up")," or ",(0,o.kt)("inlineCode",{parentName:"li"},"docker-compose up -d")," to start in detached mode (in background).")),(0,o.kt)("h2",{id:"check-ejector-is-working"},"Check Ejector is working"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Ensure there are no errors in logs and no restarts."),(0,o.kt)("li",{parentName:"ol"},"Verify that config logged on start is correct in logs."),(0,o.kt)("li",{parentName:"ol"},"If you have put presigned messages in the messages folder, make sure Loaded Messages count is greater than ",(0,o.kt)("inlineCode",{parentName:"li"},"0"),"."),(0,o.kt)("li",{parentName:"ol"},"Ensure you can see ",(0,o.kt)("inlineCode",{parentName:"li"},"Job started")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"Job finished")," lines in logs.")),(0,o.kt)("p",null,"Example of correct operation logs:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'info: Application started, version 1.0.0 {"EXECUTION_NODE":"<secret>","CONSENSUS_NODE":"<secret>","LOCATOR_ADDRESS":"0x123","STAKING_MODULE_ID":"1","OPERATOR_ID":"0","MESSAGES_LOCATION":"messages","ORACLE_ADDRESSES_ALLOWLIST":["0x123"],"MESSAGES_PASSWORD":"<secret>","BLOCKS_PRELOAD":190000,"BLOCKS_LOOP":64,"JOB_INTERVAL":384000,"HTTP_PORT":8989,"RUN_METRICS":true,"RUN_HEALTH_CHECK":true,"DRY_RUN":false}\ninfo: Loading messages from messages\ninfo: Loaded 123 messages\ninfo: Validating messages\ninfo: Starting, searching only for requests for operator 0\ninfo: Loading initial events for 190000 last blocks\ninfo: Job started {"operatorId":"0","stakingModuleId":"1","loadedMessages":123}\ninfo: Resolved Exit Bus contract address using the Locator {"exitBusAddress":"0x123"}\ninfo: Resolved Consensus contract address {"consensusAddress":"0x123"}\ninfo: Fetched the latest block from EL {"latestBlock":12345}\ninfo: Fetching request events from the Exit Bus {"eventsNumber":190000,"fromBlock":12345,"toBlock":12345}\ninfo: Loaded ValidatorExitRequest events {"amount":0}\ninfo: Handling ejection requests {"amount":0}\ninfo: Job finished\ninfo: Starting 384 seconds polling for 64 last blocks\n')),(0,o.kt)("h2",{id:"what-if-something-is-wrong"},"What if something is wrong?"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Make sure configuration is correct."),(0,o.kt)("li",{parentName:"ol"},"Make sure you are on the recommended Docker image SHA hash or version if running directly."),(0,o.kt)("li",{parentName:"ol"},"Check if Nodes are synced and are working correctly."),(0,o.kt)("li",{parentName:"ol"},"Restart the app."),(0,o.kt)("li",{parentName:"ol"},"Start the app with LOGGER_LEVEL=debug env variable and contact Lido devs with logs to investigate the problem.")),(0,o.kt)("h2",{id:"additional-resources"},"Additional Resources"),(0,o.kt)("p",null,"Validator Ejector GitHub Repository (Open Source)\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lidofinance/validator-ejector"},"https://github.com/lidofinance/validator-ejector")),(0,o.kt)("p",null,"Lido Withdrawals: Automating Validator Exits - parts can now be outdated\n",(0,o.kt)("a",{parentName:"p",href:"https://hackmd.io/@lido/BkxRxAr-o"},"https://hackmd.io/@lido/BkxRxAr-o")),(0,o.kt)("p",null,"Ejector Logic Spec - parts can now be outdated\n",(0,o.kt)("a",{parentName:"p",href:"https://hackmd.io/@lido/r1KZ4YNdj"},"https://hackmd.io/@lido/r1KZ4YNdj")))}u.isMDXComponent=!0}}]);