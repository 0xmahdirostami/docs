(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{81:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return l})),a.d(t,"metadata",(function(){return b})),a.d(t,"toc",(function(){return s})),a.d(t,"default",(function(){return d}));var n=a(3),r=a(7),i=(a(0),a(99)),l={},b={unversionedId:"contracts/deposit-security-module",id:"contracts/deposit-security-module",isDocsHomePage:!1,title:"DepositSecurityModule",description:"- Source Code",source:"@site/docs/contracts/deposit-security-module.md",sourceDirName:"contracts",slug:"/contracts/deposit-security-module",permalink:"/contracts/deposit-security-module",editUrl:"https://github.com/lidofinance/docs/blob/main/docs/contracts/deposit-security-module.md",version:"current",frontMatter:{},sidebar:"docs",previous:{title:"wstETH",permalink:"/contracts/wsteth"},next:{title:"Bug Bounties with Immunefi",permalink:"/security/bugbounty"}},s=[{value:"View Methods",id:"view-methods",children:[{value:"getNodeOperatorsRegistry()",id:"getnodeoperatorsregistry",children:[]},{value:"getPauseIntentValidityPeriodBlocks()",id:"getpauseintentvalidityperiodblocks",children:[]},{value:"getMaxDeposits()",id:"getmaxdeposits",children:[]},{value:"getMinDepositBlockDistance()",id:"getmindepositblockdistance",children:[]},{value:"getGuardianQuorum()",id:"getguardianquorum",children:[]},{value:"getGuardians()",id:"getguardians",children:[]},{value:"isGuardian()",id:"isguardian",children:[]},{value:"getGuardianIndex()",id:"getguardianindex",children:[]},{value:"isPaused()",id:"ispaused",children:[]},{value:"canDeposit()",id:"candeposit",children:[]}]},{value:"Methods",id:"methods",children:[{value:"getNodeOperatorsRegistry()",id:"getnodeoperatorsregistry-1",children:[]},{value:"setNodeOperatorsRegistry()",id:"setnodeoperatorsregistry",children:[]},{value:"getPauseIntentValidityPeriodBlocks()",id:"getpauseintentvalidityperiodblocks-1",children:[]},{value:"setPauseIntentValidityPeriodBlocks()",id:"setpauseintentvalidityperiodblocks",children:[]},{value:"setMaxDeposits()",id:"setmaxdeposits",children:[]},{value:"setMinDepositBlockDistance()",id:"setmindepositblockdistance",children:[]},{value:"setGuardianQuorum()",id:"setguardianquorum",children:[]},{value:"addGuardian()",id:"addguardian",children:[]},{value:"addGuardians()",id:"addguardians",children:[]},{value:"removeGuardian()",id:"removeguardian",children:[]},{value:"pauseDeposits()",id:"pausedeposits",children:[]},{value:"unpauseDeposits()",id:"unpausedeposits",children:[]},{value:"depositBufferedEther()",id:"depositbufferedether",children:[]}]}],o={toc:s};function d(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},o,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://github.com/lidofinance/lido-dao/blob/master/contracts/0.8.9/DepositSecurityModule.sol"},"Source Code")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("a",{parentName:"li",href:"https://etherscan.io/address/0xDb149235B6F40dC08810AA69869783Be101790e7"},"Deployed Contract"))),Object(i.b)("p",null,"Due to front-running vulnerability, we ",Object(i.b)("a",{parentName:"p",href:"https://github.com/lidofinance/lido-improvement-proposals/blob/develop/LIPS/lip-5.md"},"proposed")," to establish the Deposit Security Committee dedicated to ensuring the safety of deposits on the Beacon chain:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"monitoring the history of deposits and the set of Lido keys available for the deposit, signing and disseminating messages allowing deposits;"),Object(i.b)("li",{parentName:"ul"},"signing the special message allowing anyone to pause deposits once the malicious Node Operator pre-deposits are detected.")),Object(i.b)("p",null,"Each member must generate an EOA address to sign messages with their private key. The addresses of the committee members will be added to the smart contract."),Object(i.b)("p",null,"To make a deposit, we propose to collect a quorum of 2/3 of the signatures of the committee members. Members of the committee can collude with node operators and steal money by signing bad data that contains malicious pre-deposits. To mitigate this we propose to allow a single committee member to stop deposits and also enforce space deposits in time (e.g. no more than 150 deposits with 150 blocks in between them), to provide the single honest participant an ability to stop further deposits even if the supermajority colludes."),Object(i.b)("p",null,"The guardian himself, or anyone else who has a signed pause message, can call ",Object(i.b)("inlineCode",{parentName:"p"},"pauseDeposits")," that pauses ",Object(i.b)("inlineCode",{parentName:"p"},"DepositSecurityModule"),"."),Object(i.b)("p",null,"To prevent a replay attack, the guardians sign the block number at the time of which malicious pre-deposits are observed. After a certain number of blocks (",Object(i.b)("inlineCode",{parentName:"p"},"pauseIntentValidityPeriodBlocks"),") message becomes invalid."),Object(i.b)("h2",{id:"view-methods"},"View Methods"),Object(i.b)("h3",{id:"getnodeoperatorsregistry"},"getNodeOperatorsRegistry()"),Object(i.b)("p",null,"Returns NodeOperatorsRegistry contract address."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getNodeOperatorsRegistry() external view returns (address)\n")),Object(i.b)("h3",{id:"getpauseintentvalidityperiodblocks"},"getPauseIntentValidityPeriodBlocks()"),Object(i.b)("p",null,"Returns ",Object(i.b)("inlineCode",{parentName:"p"},"PAUSE_INTENT_VALIDITY_PERIOD_BLOCKS")," (see ",Object(i.b)("inlineCode",{parentName:"p"},"pauseDeposits"),")."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getPauseIntentValidityPeriodBlocks() external view returns (uint256)\n")),Object(i.b)("h3",{id:"getmaxdeposits"},"getMaxDeposits()"),Object(i.b)("p",null,"Returns ",Object(i.b)("inlineCode",{parentName:"p"},"MAX_DEPOSITS")," (see ",Object(i.b)("inlineCode",{parentName:"p"},"depositBufferedEther"),")."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getMaxDeposits() external view returns (uint256)\n")),Object(i.b)("h3",{id:"getmindepositblockdistance"},"getMinDepositBlockDistance()"),Object(i.b)("p",null,"Returns ",Object(i.b)("inlineCode",{parentName:"p"},"MIN_DEPOSIT_BLOCK_DISTANCE"),"  (see ",Object(i.b)("inlineCode",{parentName:"p"},"depositBufferedEther"),")."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getMinDepositBlockDistance() external view returns (uint256)\n")),Object(i.b)("h3",{id:"getguardianquorum"},"getGuardianQuorum()"),Object(i.b)("p",null,"Returns number of valid guardian signatures required to vet (depositRoot, keysOpIndex) pair."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getGuardianQuorum() external view returns (uint256)\n")),Object(i.b)("h3",{id:"getguardians"},"getGuardians()"),Object(i.b)("p",null,"Returns guardian committee member list."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getGuardians() external view returns (address[] memory)\n")),Object(i.b)("h3",{id:"isguardian"},"isGuardian()"),Object(i.b)("p",null,"Checks whether the given address is a guardian."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function isGuardian(address addr) external view returns (bool)\n")),Object(i.b)("h4",{id:"parameters"},"Parameters:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"addr")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",{parentName:"tr",align:null},"Valid ETH-1 address")))),Object(i.b)("h3",{id:"getguardianindex"},"getGuardianIndex()"),Object(i.b)("p",null,"Returns index of the guardian, or -1 if the address is not a guardian."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getGuardianIndex(address addr) external view returns (int256)\n")),Object(i.b)("h4",{id:"parameters-1"},"Parameters:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"addr")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",{parentName:"tr",align:null},"Valid ETH-1 address")))),Object(i.b)("h3",{id:"ispaused"},"isPaused()"),Object(i.b)("p",null,"Returns whether deposits were paused."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function isPaused() external view returns (bool)\n")),Object(i.b)("h3",{id:"candeposit"},"canDeposit()"),Object(i.b)("p",null,"Returns whether depositBufferedEther can be called, given that the caller will provide\nguardian attestations of non-stale deposit root and ",Object(i.b)("inlineCode",{parentName:"p"},"keysOpIndex"),", and the number of\nsuch attestations will be enough to reach quorum."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function canDeposit() external view returns (bool)\n")),Object(i.b)("h2",{id:"methods"},"Methods"),Object(i.b)("h3",{id:"getnodeoperatorsregistry-1"},"getNodeOperatorsRegistry()"),Object(i.b)("p",null,"Returns NodeOperatorsRegistry contract address."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getNodeOperatorsRegistry() external view returns (address)\n")),Object(i.b)("h3",{id:"setnodeoperatorsregistry"},"setNodeOperatorsRegistry()"),Object(i.b)("p",null,"Sets NodeOperatorsRegistry contract address. Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function setNodeOperatorsRegistry(address newValue)\n")),Object(i.b)("h4",{id:"parameters-2"},"Parameters:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"newValue")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",{parentName:"tr",align:null},"NodeOperatorsRegistry contract address")))),Object(i.b)("h3",{id:"getpauseintentvalidityperiodblocks-1"},"getPauseIntentValidityPeriodBlocks()"),Object(i.b)("p",null,"Returns ",Object(i.b)("inlineCode",{parentName:"p"},"pauseIntentValidityPeriodBlocks")," (see ",Object(i.b)("inlineCode",{parentName:"p"},"pauseDeposits"),")."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function getPauseIntentValidityPeriodBlocks() external view returns (uint256)\n")),Object(i.b)("h3",{id:"setpauseintentvalidityperiodblocks"},"setPauseIntentValidityPeriodBlocks()"),Object(i.b)("p",null,"Sets ",Object(i.b)("inlineCode",{parentName:"p"},"pauseIntentValidityPeriodBlocks"),". Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function setPauseIntentValidityPeriodBlocks(uint256 newValue)\n")),Object(i.b)("h4",{id:"parameters-3"},"Parameters:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"newValue")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"uint256")),Object(i.b)("td",{parentName:"tr",align:null},"Number of blocks after which message becomes invalid")))),Object(i.b)("h3",{id:"setmaxdeposits"},"setMaxDeposits()"),Object(i.b)("p",null,"Sets ",Object(i.b)("inlineCode",{parentName:"p"},"maxDepositsPerBlock"),". Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function setMaxDeposits(uint256 newValue)\n")),Object(i.b)("h3",{id:"setmindepositblockdistance"},"setMinDepositBlockDistance()"),Object(i.b)("p",null,"Sets ",Object(i.b)("inlineCode",{parentName:"p"},"minDepositBlockDistance"),". Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function setMinDepositBlockDistance(uint256 newValue)\n")),Object(i.b)("h3",{id:"setguardianquorum"},"setGuardianQuorum()"),Object(i.b)("p",null,"Sets ",Object(i.b)("inlineCode",{parentName:"p"},"quorum"),". Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function setGuardianQuorum(uint256 newValue)\n")),Object(i.b)("h3",{id:"addguardian"},"addGuardian()"),Object(i.b)("p",null,"Adds a guardian address and sets a new quorum value.\nReverts if the address is already a guardian."),Object(i.b)("p",null,"Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function addGuardian(address addr, uint256 newQuorum)\n")),Object(i.b)("h4",{id:"parameters-4"},"Parameters:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"addr")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",{parentName:"tr",align:null},"Guardian address")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"newQuorum")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"uint256")),Object(i.b)("td",{parentName:"tr",align:null},"New Quorum value")))),Object(i.b)("h3",{id:"addguardians"},"addGuardians()"),Object(i.b)("p",null,"Adds a set of guardian addresses and sets a new quorum value.\nReverts any of them is already a guardian."),Object(i.b)("p",null,"Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function addGuardians(address[] memory addresses, uint256 newQuorum)\n")),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"addresses")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"address[]")),Object(i.b)("td",{parentName:"tr",align:null},"Array of Guardian addresses")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"newQuorum")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"uint256")),Object(i.b)("td",{parentName:"tr",align:null},"New Quorum value")))),Object(i.b)("h3",{id:"removeguardian"},"removeGuardian()"),Object(i.b)("p",null,"Removes a guardian with the given address and sets a new quorum value."),Object(i.b)("p",null,"Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function removeGuardian(address addr, uint256 newQuorum)\n")),Object(i.b)("h4",{id:"parameters-5"},"Parameters:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"addr")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"address")),Object(i.b)("td",{parentName:"tr",align:null},"Guardian address")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"newQuorum")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"uint256")),Object(i.b)("td",{parentName:"tr",align:null},"New Quorum value")))),Object(i.b)("h3",{id:"pausedeposits"},"pauseDeposits()"),Object(i.b)("p",null,"Pauses deposits given that both conditions are satisfied (reverts otherwise):"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"The function is called by the guardian with index guardianIndex OR sig\nis a valid signature by the guardian with index guardianIndex of the data\ndefined below.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"block.number - blockNumber <= pauseIntentValidityPeriodBlocks"),Object(i.b)("p",{parentName:"li"},"The signature, if present, must be produced for keccak256 hash of the following\nmessage (each component taking 32 bytes):"),Object(i.b)("p",{parentName:"li"},"| PAUSE_MESSAGE_PREFIX | blockNumber"))),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function pauseDeposits(uint256 blockNumber, Signature memory sig)\n")),Object(i.b)("h4",{id:"parameters-6"},"Parameters:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",{parentName:"tr",align:null},"Name"),Object(i.b)("th",{parentName:"tr",align:null},"Type"),Object(i.b)("th",{parentName:"tr",align:null},"Description"))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"blockNumber")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"uint256")),Object(i.b)("td",{parentName:"tr",align:null},"Block number")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"sig")),Object(i.b)("td",{parentName:"tr",align:null},Object(i.b)("inlineCode",{parentName:"td"},"Signature")),Object(i.b)("td",{parentName:"tr",align:null},"Short ECDSA guardian signature as defined in ",Object(i.b)("a",{parentName:"td",href:"https://eips.ethereum.org/EIPS/eip-2098"},"https://eips.ethereum.org/EIPS/eip-2098"))))),Object(i.b)("h3",{id:"unpausedeposits"},"unpauseDeposits()"),Object(i.b)("p",null,"Unpauses deposits. Only callable by the owner."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function unpauseDeposits()\n")),Object(i.b)("h3",{id:"depositbufferedether"},"depositBufferedEther()"),Object(i.b)("p",null,"Calls Lido.depositBufferedEther(maxDepositsPerBlock)."),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",{parentName:"div",className:"admonition-heading"},Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",{parentName:"h5",className:"admonition-icon"},Object(i.b)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(i.b)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(i.b)("div",{parentName:"div",className:"admonition-content"},Object(i.b)("p",{parentName:"div"},"Reverts if any of the following is true:"),Object(i.b)("ol",{parentName:"div"},Object(i.b)("li",{parentName:"ol"},"IDepositContract.get_deposit_root() != depositRoot."),Object(i.b)("li",{parentName:"ol"},"INodeOperatorsRegistry.getKeysOpIndex() != keysOpIndex."),Object(i.b)("li",{parentName:"ol"},"The number of guardian signatures is less than getGuardianQuorum()."),Object(i.b)("li",{parentName:"ol"},"An invalid or non-guardian signature received."),Object(i.b)("li",{parentName:"ol"},"block.number - lastLidoDepositBlock < MIN_DEPOSIT_BLOCK_DISTANCE"),Object(i.b)("li",{parentName:"ol"},"blockhash(blockNumber) == blockHash")))),Object(i.b)("p",null,"Signatures must be sorted in ascending order by index of the guardian. Each signature must\nbe produced for keccak256 hash of the following message (each component taking 32 bytes):"),Object(i.b)("p",null,"| ATTEST_MESSAGE_PREFIX | depositRoot | keysOpIndex | blockNumber | blockHash |"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-sol"},"function depositBufferedEther(\n        bytes32 depositRoot,\n        uint256 keysOpIndex,\n        uint256 blockNumber,\n        bytes32 blockHash,\n        Signature[] memory sortedGuardianSignatures\n    )\n")))}d.isMDXComponent=!0},99:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=r.a.createContext({}),d=function(e){var t=r.a.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):b(b({},t),e)),a},c=function(e){var t=d(e.components);return r.a.createElement(o.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,o=s(e,["components","mdxType","originalType","parentName"]),c=d(a),p=n,m=c["".concat(l,".").concat(p)]||c[p]||u[p]||i;return a?r.a.createElement(m,b(b({ref:t},o),{},{components:a})):r.a.createElement(m,b({ref:t},o))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,l=new Array(i);l[0]=p;var b={};for(var s in t)hasOwnProperty.call(t,s)&&(b[s]=t[s]);b.originalType=e,b.mdxType="string"==typeof e?e:n,l[1]=b;for(var o=2;o<i;o++)l[o]=a[o];return r.a.createElement.apply(null,l)}return r.a.createElement.apply(null,a)}p.displayName="MDXCreateElement"}}]);